<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>L Gamest — Lunar Thermal Mission Simulator</title>
<style>
  body{font-family:Inter,Segoe UI,Roboto,Arial,sans-serif; margin:0; background:#0b1220; color:#e6eef8; display:flex; flex-direction:column; align-items:center;}
  header{width:100%; background:linear-gradient(90deg,#051428,#123041); padding:18px 24px; box-shadow:0 6px 20px rgba(0,0,0,.6); display:flex; gap:12px; align-items:center;}
  header h1{margin:0; font-size:20px; letter-spacing:0.6px;}
  header .brand{background:#071a2a; padding:6px 10px; border-radius:8px; border:1px solid rgba(255,255,255,0.04);}
  main{max-width:1100px; width:100%; padding:22px; display:grid; grid-template-columns: 420px 1fr; gap:18px; box-sizing:border-box;}
  .panel{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01)); border-radius:12px; padding:12px; box-shadow:0 6px 24px rgba(0,0,0,0.5);}
  .status .meters{display:flex; gap:10px; flex-wrap:wrap;}
  .meter{flex:1 1 130px; padding:8px; background:rgba(255,255,255,0.02); border-radius:8px; border:1px solid rgba(255,255,255,0.03);}
  .meter h3{margin:4px 0 8px; font-size:13px; color:#bfe4ff;}
  .meter .value{font-weight:700; font-size:20px;}
  .controls{display:flex; flex-direction:column; gap:8px;}
  .control-row{display:flex; gap:8px; align-items:center;}
  .control-row label{flex:1; font-size:13px;}
  input[type=range]{width:160px;}
  button{background:#1b6fff; color:white; border:none; padding:8px 12px; border-radius:8px; cursor:pointer; font-weight:600;}
  button.ghost{background:transparent; border:1px solid rgba(255,255,255,0.06);}
  canvas{background:#071422; border-radius:8px; width:100%; height:420px; display:block;}
  footer{width:100%; text-align:center; padding:14px; font-size:13px; color:#b7c8d9; margin-top:18px;}
  .log{height:120px; overflow:auto; background:rgba(0,0,0,0.3); padding:8px; border-radius:8px; font-family:monospace; font-size:12px;}
  .success{color:#a3ffb1;} .danger{color:#ff9b9b;}
  .brandline{font-size:13px; color:#9ec9ff; margin-top:6px;}
  .notice{font-size:13px; color:#cfe7ff; margin-bottom:8px;}
  .col{display:flex; flex-direction:column; gap:10px;}
  .ai-suggestions{background:rgba(255,255,255,0.02); padding:8px; border-radius:8px;}
  .small{font-size:12px; color:#b7c8d9;}
</style>
</head>
<body>
<header>
  <div class="brand"><strong>L Gamest</strong></div>
  <h1>הדמיית משימת לונאר — מערכת חום, לחץ וטמפרטורה | L Gamest</h1>
</header>

<main>
  <section class="panel status">
    <div class="brandline">מטרת ההדמיה: לשמור על סביבה בטוחה בתוך החללית בזמן משימה לירח.</div>
    <div style="margin-top:10px;" class="notice">זו הדמיה חינוכית שנוצרה על-ידי L Gamest — לצורך שיתוף רעיונות עם גורמים טכניים (SpaceIL, NASA וכו'). אין זו התחייבות לשיתוף פעולה רשמי.</div>

    <div class="meters">
      <div class="meter">
        <h3>טמפרטורה פנימית</h3>
        <div class="value" id="tempValue">22 °C</div>
        <div class="small">טווח בטוח: 15 — 30 °C</div>
      </div>
      <div class="meter">
        <h3>לחץ פנימי</h3>
        <div class="value" id="pressureValue">101.3 kPa</div>
        <div class="small">טווח בטוח: 90 — 110 kPa</div>
      </div>
      <div class="meter">
        <h3>אנרגיה (סוללה)</h3>
        <div class="value" id="energyValue">100 %</div>
        <div class="small">ניהול צריכת אנרגיה קריטי למשימה</div>
      </div>
      <div class="meter">
        <h3>מעמד החללית</h3>
        <div class="value" id="statusValue">Nominal</div>
        <div class="small">מצב מערכות פנימי</div>
      </div>
    </div>

    <div style="margin-top:12px;" class="col">
      <div class="controls">
        <div class="control-row">
          <label>הפעלה לחמם (heater) — עוצמה</label>
          <input id="heaterRange" type="range" min="0" max="100" value="0">
          <div id="heaterVal" class="small">0%</div>
        </div>
        <div class="control-row">
          <label>פתח ונטיל (vent) — פתיחה</label>
          <input id="ventRange" type="range" min="0" max="100" value="0">
          <div id="ventVal" class="small">סגור</div>
        </div>
        <div class="control-row">
          <label>רדיאטור חיצוני (deploy)</label>
          <button id="toggleRadiator" class="ghost">פתח</button>
          <div id="radStatus" class="small">סגור</div>
        </div>
        <div class="control-row">
          <label>פומפה קירור (pump) — מהירות</label>
          <input id="pumpRange" type="range" min="0" max="100" value="50">
          <div id="pumpVal" class="small">50%</div>
        </div>
        <div style="display:flex; gap:8px; margin-top:8px;">
          <button id="startBtn">התחל/הפעל</button>
          <button id="pauseBtn" class="ghost">השהה</button>
          <button id="resetBtn" class="ghost">איפוס</button>
        </div>
      </div>

      <div class="ai-suggestions">
        <strong>AI Adviser (Simulator)</strong>
        <div id="aiText" class="small">מערכת העצה החכמה תנתח את המצב ותציע צעדים.</div>
      </div>
    </div>
  </section>

  <section class="panel">
    <canvas id="vizCanvas" width="640" height="420"></canvas>

    <div style="margin-top:10px; display:flex; gap:12px; align-items:flex-start;">
      <div style="flex:1;">
        <div class="log" id="eventLog"></div>
      </div>
      <div style="width:260px;">
        <div style="margin-bottom:8px;"><strong>מצב משימה</strong></div>
        <div class="small">מכסה משימה: שמור על טמפרטורה ולחץ תקינים עד הנחיתה.</div>
        <div style="margin-top:8px;"><strong>כותרת זיהוי:</strong></div>
        <div style="font-weight:700; margin-top:6px;">L Gamest — Lunar Prep Module</div>
        <div style="margin-top:8px;" class="small">יצירה של L Gamest לתצוגה ולשיתוף עם גורמים טכניים.</div>
      </div>
    </div>

  </section>
</main>

<footer>
  © L Gamest — Educational Simulation • שימו לב: הדמיה זו אינה מסמך טכני מחייב עבור SpaceIL או NASA.
</footer>

<script>
// Simple physics model for temperature, pressure, energy
const state = {
  temp: 22.0,        // degrees Celsius
  pressure: 101.3,   // kPa
  energy: 100.0,     // percent
  heaterPower: 0,    // 0-100
  ventOpen: 0,       // 0-100
  radiatorDeployed: false,
  pumpPower: 50,     // 0-100
  running: false,
  time: 0
};

// constants (tunable)
const ambientSpace = { temp: -170, pressure: 0.0001 }; // space-like environment (radiative cold)
const thermalLossCoeff = 0.02;  // how fast heat leaks to exterior when radiator open
const heaterEfficiency = 0.1;   // increase degC per unit heater per second (scaled)
const pumpEffectiveness = 0.03; // pump reduces temp by function per second
const ventLeakRate = 0.015;     // vent reduces pressure per unit vent per second
const energyConsumptionRate = 0.02; // base consumption per second
const heaterEnergyRate = 0.06;  // additional energy per heater unit
const pumpEnergyRate = 0.03;    // energy usage by pump

// UI elements
const tempValue = document.getElementById('tempValue');
const pressureValue = document.getElementById('pressureValue');
const energyValue = document.getElementById('energyValue');
const statusValue = document.getElementById('statusValue');
const heaterRange = document.getElementById('heaterRange');
const ventRange = document.getElementById('ventRange');
const heaterVal = document.getElementById('heaterVal');
const ventVal = document.getElementById('ventVal');
const pumpRange = document.getElementById('pumpRange');
const pumpVal = document.getElementById('pumpVal');
const toggleRadiator = document.getElementById('toggleRadiator');
const radStatus = document.getElementById('radStatus');
const startBtn = document.getElementById('startBtn');
const pauseBtn = document.getElementById('pauseBtn');
const resetBtn = document.getElementById('resetBtn');
const eventLog = document.getElementById('eventLog');
const aiText = document.getElementById('aiText');
const canvas = document.getElementById('vizCanvas');
const ctx = canvas.getContext('2d');

function logEvent(txt, cls){ 
  const line = document.createElement('div');
  line.textContent = `[t=${Math.floor(state.time)}s] ${txt}`;
  if(cls) line.className = cls;
  eventLog.prepend(line);
}

// controls
heaterRange.addEventListener('input', ()=>{
  state.heaterPower = Number(heaterRange.value);
  heaterVal.textContent = state.heaterPower + '%';
});
ventRange.addEventListener('input', ()=>{
  state.ventOpen = Number(ventRange.value);
  ventVal.textContent = state.ventOpen > 0 ? state.ventOpen + '%' : 'סגור';
});
pumpRange.addEventListener('input', ()=>{
  state.pumpPower = Number(pumpRange.value);
  pumpVal.textContent = state.pumpPower + '%';
});
toggleRadiator.addEventListener('click', ()=>{
  state.radiatorDeployed = !state.radiatorDeployed;
  radStatus.textContent = state.radiatorDeployed ? 'פתוח' : 'סגור';
  toggleRadiator.textContent = state.radiatorDeployed ? 'סגור' : 'פתח';
  logEvent('רדיאטור ' + (state.radiatorDeployed ? 'נפתח' : 'נסגר'));
});

startBtn.addEventListener('click', ()=>{ state.running = true; startBtn.textContent = 'רץ'; logEvent('הדמיה הופעלה'); });
pauseBtn.addEventListener('click', ()=>{ state.running = !state.running; pauseBtn.textContent = state.running ? 'השהה' : 'הפעל'; logEvent(state.running ? 'הדמיה הופעלה' : 'הדמיה הושהתה'); });
resetBtn.addEventListener('click', ()=>{ resetState(); logEvent('איפוס הדמיה'); });

function resetState(){
  state.temp = 22.0;
  state.pressure = 101.3;
  state.energy = 100.0;
  state.heaterPower = 0;
  state.ventOpen = 0;
  state.radiatorDeployed = false;
  state.pumpPower = 50;
  state.running = false;
  state.time = 0;
  heaterRange.value = 0; heaterVal.textContent = '0%';
  ventRange.value = 0; ventVal.textContent = 'סגור';
  pumpRange.value = 50; pumpVal.textContent = '50%';
  radStatus.textContent = 'סגור';
  toggleRadiator.textContent = 'פתח';
  statusValue.textContent = 'Idle';
  eventLog.innerHTML = '';
  aiText.textContent = 'מערכת העצה החכמה תנתח את המצב ותציע צעדים.';
}

// physics update per second (dt)
function step(dt){
  // heater adds heat
  const heaterHeat = state.heaterPower * heaterEfficiency * dt;
  // pump cools proportional to pump power and energy available
  const pumpCooling = state.pumpPower * pumpEffectiveness * dt * (state.energy / 100);
  // radiator if deployed increases heat loss to ambient (radiative)
  const radiatorLoss = state.radiatorDeployed ? thermalLossCoeff * dt * (state.temp - ambientSpace.temp) * 0.004 : 0;
  // basic conduction/convective loss to ambient (very small in space; radiation dominates)
  const passiveLoss = 0.001 * dt * (state.temp - ambientSpace.temp);
  // update temp
  state.temp += heaterHeat - pumpCooling - radiatorLoss - passiveLoss;
  // vent reduces pressure proportional to vent open and any pressure difference
  const ventLeak = state.ventOpen * ventLeakRate * dt * Math.max(0, state.pressure - ambientSpace.pressure) * 0.1;
  state.pressure -= ventLeak;
  // simple pressure recovery if sealed and pump on (simulates compressor working)
  if(state.ventOpen < 1){
    state.pressure += 0.002 * (state.pumpPower/100) * dt * Math.max(0, 101.3 - state.pressure);
  }
  // energy consumption
  const energyConsumed = (energyConsumptionRate + (state.heaterPower*heaterEnergyRate + state.pumpPower*pumpEnergyRate)/100) * dt;
  state.energy = Math.max(0, state.energy - energyConsumed);

  // time
  state.time += dt;

  // status checks
  let status = 'Nominal';
  if(state.temp < 0 || state.temp > 60) status = 'Warning: Temp';
  if(state.pressure < 50) status = 'Warning: Pressure Low';
  if(state.energy < 10) status = 'Warning: Low Energy';
  if(state.temp < -50 || state.temp > 90 || state.pressure < 10) status = 'CRITICAL';
  statusValue.textContent = status;

  // logging events for big changes
  if(state.time % 5 < dt){ // every ~5s make a check note
    if(state.temp > 35) logEvent('טמפרטורה גבוהה — שקול לקרר באמצעות פומפה/רדיאטור', 'danger');
    if(state.pressure < 95 && state.pressure > 60) logEvent('לחץ נמוך — בדוק שסתום או המשאבה', 'danger');
  }
}

// AI adviser (simple rule-based suggestions)
function aiAdvisor(){
  const suggestions = [];
  if(state.temp > 30){
    suggestions.push('טמפרטורה גבוהה: קח צעדים – הורד חימום, העלה מהירות פומפה, פתח רדיאטור.');
  } else if(state.temp < 10){
    suggestions.push('טמפרטורה נמוכה: העלה חימום או סגור ונטיל.');
  } else {
    suggestions.push('טמפרטורה בטווח תקין.');
  }
  if(state.pressure < 95){
    suggestions.push('לחץ נמוך: בדוק ונטיל; אם הוונט סגור - הגדל כוח המשאבה.');
  } else if(state.pressure > 110){
    suggestions.push('לחץ גבוה: עבור לניטור טיס ולשחרור לחץ מבוקר.');
  } else {
    suggestions.push('לחץ תקין.');
  }
  if(state.energy < 30){
    suggestions.push('אנרגיה נמוכה: הורד מערכות שאינן חיוניות. שקול חיסכון בחשמל.');
  }
  aiText.textContent = suggestions.join(' ');
}

// draw visualization
function draw(){
  ctx.clearRect(0,0,canvas.width,canvas.height);
  // background stars
  for(let i=0;i<60;i++){
    ctx.fillStyle = 'rgba(255,255,255,0.04)';
    const x = (i*37) % canvas.width;
    const y = (i*71) % canvas.height;
    ctx.fillRect(x+3,y+5,1,1);
  }
  // draw spacecraft box
  ctx.save();
  ctx.translate(40,40);
  ctx.fillStyle = '#0f2330';
  ctx.strokeStyle = '#23586f';
  ctx.lineWidth = 2;
  ctx.fillRect(0,0,320,320);
  ctx.strokeRect(0,0,320,320);
  // internal panels: temp color mapping
  const tempNorm = Math.min(1, Math.max(0, (state.temp+50)/140));
  const r = Math.floor(20 + 200*tempNorm);
  const g = Math.floor(200 - 80*tempNorm);
  const b = Math.floor(150 - 50*tempNorm);
  ctx.fillStyle = `rgba(${r},${g},${b},0.25)`;
  ctx.fillRect(12,12,296,296);

  // draw heater icon
  ctx.fillStyle = '#ffb86b';
  ctx.fillRect(20,260,60,10);
  ctx.fillText('Heater',26,255);

  // draw pump icon
  ctx.beginPath();
  ctx.fillStyle = '#7bdcff';
  ctx.arc(260,280,18,0,Math.PI*2);
  ctx.fill();
  ctx.fillStyle = '#08323d';
  ctx.fillText('Pump',242,245);

  // radiator
  ctx.fillStyle = state.radiatorDeployed ? '#a0d7ff' : '#143a4a';
  ctx.fillRect(340,40,120,200);
  ctx.strokeStyle = '#0b2230';
  ctx.strokeRect(340,40,120,200);
  ctx.fillStyle = '#cfe8ff';
  ctx.fillText('Radiator',350,36);

  // info text
  ctx.fillStyle = '#cfe8ff';
  ctx.font = '14px sans-serif';
  ctx.fillText('Temp: ' + state.temp.toFixed(1) + '°C', 20,20);
  ctx.fillText('Pressure: ' + state.pressure.toFixed(1) + ' kPa', 160,20);
  ctx.fillText('Energy: ' + state.energy.toFixed(0) + '%', 280,20);

  // brand lash
  ctx.font = '16px sans-serif';
  ctx.fillStyle = '#9fcfff';
  ctx.fillText('L Gamest — Lunar Prep Module', 20, 330);

  ctx.restore();

  // HUD summary
  ctx.fillStyle = '#bfe4ff';
  ctx.font = '12px sans-serif';
  ctx.fillText('AI Adviser: ' + aiText.textContent.substring(0,60) + '...', 12, canvas.height - 10);
}

// UI update loop
function uiUpdate(){
  tempValue.textContent = state.temp.toFixed(1) + ' °C';
  pressureValue.textContent = state.pressure.toFixed(1) + ' kPa';
  energyValue.textContent = Math.max(0, state.energy.toFixed(0)) + ' %';
}

// main loop ~ 10Hz for smoothness but physics per second steps
let last = performance.now();
function loop(ts){
  const dtSec = Math.min(0.2, (ts - last)/1000);
  last = ts;
  if(state.running){
    // integrate physics using smaller steps for stability
    const physicsSteps = Math.max(1, Math.floor(1*dtSec/0.15));
    // we'll step once with dt=1s scaled by dtSec to keep simple
    step(dtSec);
    aiAdvisor();
  }
  uiUpdate();
  draw();
  requestAnimationFrame(loop);
}

// initialize
resetState();
draw();
requestAnimationFrame(loop);

// safety: prevent negative energy from running forever
setInterval(()=>{
  if(state.running && state.energy <= 0){
    state.running = false;
    statusValue.textContent = 'Mission: Out of energy - halted';
    logEvent('המשימה הופסקה: אנרגיה אזל', 'danger');
  }
},1000);

</script>
</body>
</html>
